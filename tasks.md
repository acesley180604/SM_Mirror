# Phase 0: 技術可行性驗證 (Proof of Concept) - 使用 Stable-Makeup

## 目標
- 整合 MediaPipe 人臉偵測與 Stable-Makeup 專業化妝轉移技術
- 證明從人臉偵測到專業化妝轉移的完整流程可行性

---

## Stable-Makeup vs 傳統 Stable Diffusion Inpainting

### 優勢對比
| 特性 | Stable Diffusion Inpainting | Stable-Makeup |
|------|----------------------------|---------------|
| **專業性** | 通用圖像修復 | 專門為化妝設計 |
| **效果品質** | 基礎，可能不自然 | 專業，保持面部特徵 |
| **化妝理解** | 無專業知識 | 理解化妝細節、顏色、質感 |
| **參考驅動** | 僅文字提示 | 可從參考圖片學習風格 |
| **複雜度支援** | 有限 | 支援淡妝到濃妝 |

---

## 任務清單

### 1. 環境建立與依賴安裝
- [x] 安裝 Python（建議 3.8 以上）
- [x] 建立虛擬環境 (Virtual Environment)
- [x] 安裝基礎套件（torch, diffusers, transformers, accelerate, mediapipe, pillow, matplotlib）
- [ ] 克隆 Stable-Makeup 專案
- [ ] 安裝 Stable-Makeup 相關依賴
- [ ] 下載預訓練模型權重

### 2. MediaPipe 人臉偵測整合

#### 2.1 基礎人臉偵測
- [x] 使用 MediaPipe Face Mesh 進行人臉偵測
- [x] 提取嘴唇區域關鍵點座標
- [x] 視覺化驗證人臉偵測結果

#### 2.2 擴展到全臉偵測
- [ ] 提取眼部區域關鍵點（眼影、眼線）
- [ ] 提取眉毛區域關鍵點
- [ ] 提取臉頰區域關鍵點（腮紅）
- [ ] 建立完整的面部區域映射

### 3. Stable-Makeup 整合

#### 3.1 模型準備
- [ ] 下載 Stable-Makeup 預訓練權重
  - [ ] makeup_encoder (pytorch_model.bin)
  - [ ] id_encoder (pytorch_model_1.bin)
  - [ ] pose_encoder (pytorch_model_2.bin)
  - [ ] SPIGA 人臉結構模型
- [ ] 驗證模型文件完整性

#### 3.2 Pipeline 建立
- [ ] 初始化 Stable Diffusion v1.5 基礎模型
- [ ] 載入 Stable-Makeup 的三個編碼器
- [ ] 建立完整的推理 Pipeline
- [ ] 測試模型載入與 GPU 相容性

#### 3.3 SPIGA 人臉結構分析
- [ ] 整合 SPIGA 人臉關鍵點偵測
- [ ] 生成人臉結構控制圖像
- [ ] 結合 MediaPipe 與 SPIGA 的優勢

### 4. 完整化妝轉移流程

#### 4.1 單一化妝轉移
- [ ] 實現源圖片 + 化妝參考 → 化妝結果的流程
- [ ] 測試不同化妝風格的轉移效果
- [ ] 優化推理參數（guidance_scale 等）

#### 4.2 多區域化妝控制
- [ ] 分別控制嘴唇、眼部、臉頰的化妝
- [ ] 實現漸進式化妝疊加
- [ ] 支援混合多種化妝風格

### 5. 效果驗證與優化

#### 5.1 品質評估
- [ ] 測試不同光照條件下的效果
- [ ] 測試不同面部角度的適應性
- [ ] 評估化妝轉移的自然度

#### 5.2 性能優化
- [ ] 優化推理速度
- [ ] 減少 GPU 記憶體使用
- [ ] 實現批次處理能力

---

## 開發階段劃分

### 階段 1：基礎整合（當前）
- MediaPipe 人臉偵測 ✓
- Stable-Makeup 環境建立
- 單一化妝轉移測試

### 階段 2：功能擴展
- 多區域化妝控制
- 化妝風格混合
- 效果優化

### 階段 3：產品化準備
- 性能優化
- 錯誤處理
- 用戶介面準備

---

## 完成標誌
- [ ] 成功運行完整的 MediaPipe + Stable-Makeup 流程
- [ ] 能夠從源圖片和化妝參考生成高品質化妝轉移結果
- [ ] 效果明顯優於傳統 Stable Diffusion Inpainting 方法

---

## 潛在挑戰與解決方案

### 挑戰 1：模型大小與記憶體需求
- **問題**：Stable-Makeup 需要多個大型模型
- **解決方案**：使用模型量化、分批載入、CPU/GPU 混合推理

### 挑戰 2：依賴套件複雜性
- **問題**：SPIGA、FaceLib 等套件安裝複雜
- **解決方案**：Docker 容器化、簡化依賴、提供替代方案

### 挑戰 3：推理速度
- **問題**：多模型推理可能較慢
- **解決方案**：模型優化、並行處理、快取機制

### 挑戰 4：化妝效果控制
- **問題**：如何精確控制化妝強度和區域
- **解決方案**：參數調優、遮罩精細化、多步驟處理
